## Lab - Locating Log Files

## Part 1: Log File Overview

> Log files (also spelled logfiles), are files used by computers to log events. Software programs, background
processes, services, or transactions between services, including the operating system itself, may generate
such events. Log files are dependent on the application that generates them. It is up to the application
developer to conform to log file convention. Software documentation should include information on its log
files.

### Step 1: Web server log file example

* Consider the single log entry below. It was generated by Apache, a popular web server

      [Wed Mar 22 11:23:12.207022 2017] [core:error] [pid 3548:tid 4682351596] [client
      209.165.200.230] File does not exist: /var/www/apache/htdocs/favicon.ico

* The single log entry above represents a web event recorded by Apache. A few pieces of information are important in web transactions, including client IP address, time and details of the transaction. The entry above can be broken down into five main parts:
* `Timestamp`: This part records when the event took place. It is very important that the server clock is correctly synchronized as it allows for accurately cross-referencing and tracing back events.
* `Type`: This is the type of event. In this case, it was an error.
* `PID`: This contains information about the process ID used by Apache at the moment.
* `Client`: This records the IP address of the requesting client.
* `Description`: This contains a description of the event

* Use the cat command below to list a web server sample log file. The sample file is located at /var/log

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/213a614d-ac74-416a-8066-ea33ffd7f486)

### Step 2: Operating system log file example

> Any software can keep log files, including the operating system itself. Conventionally, Linux uses the /var/log
directory to stores various log files, including operating system logs. Modern operating systems are complex
pieces of software and therefore use several different files to log events. This section takes a quick look at the
/var/log/messages file.

* Stored under /var/log, the messages file stores various system events. The connection of new USB drive, a network card becoming available, and too many missed root login attempts, are a few examples of events logged to the /var/log/messages file. Use the more command to display the contents of the /var/log/messages file. Unlike the cat command, more allows for a paced navigation through the file. Press ENTER to advance line-by-line or SPACE to advance an entire page. Press q or CTRL + C to abort and exit more.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/dff39aaf-51ff-48d6-bc51-0ba77d4c3c35)

* Notice that the events listed above are very different from the web server events. Because the operating system itself is generating this log, all recorded events are in relation to the OS itself
* If necessary, enter Ctrl + C to exit out of the previous command.

## Part 2: Locating Log Files in Unknown Systems

* The CyberOps Workstation VM includes nginx, a lightweight web server. This section will show how to find and display nginx logs using the CyberOps Workstation VM.
* When working with new software, the first step is to look at the documentation. It provides important information about the software, including information about its log files. Use the man command to display the nginx manual page:

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/796e1c3f-3068-4122-8362-de533a9f5d55)

* Scroll down the page to locate the nginx logging section. The documentation makes it clear that nginx supports logging, with the location of its log files defined at compilation time.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/11597d37-f71d-49cf-b07e-3d9508d5cdf7)

* The manual page also contains information on the files used by nginx. Scroll down further to display the nginx operating files under the Files section:

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/9c6c2dd6-5296-4bf2-bc2b-b76d15a286d1)

* The outputs above help you to conclude that nginx supports logging and that it can save to log files. The output also hints at the existence of a configuration file for nginx

* Before looking for nginx files, use the ps and the grep commands to ensure nginx is running in the VM.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/632faf9a-b854-4b9f-acff-0c62db2b3f79)

* The output above confirms that nginx is running. In addition, the output also displays the parameters used when nginx was started. nginx process ID is being stored in /run/nginx.pid and error messages are being redirected to the terminal. 
* Because the location to the log files was not specified, the global nginx configuration file should be checked for the location of the log files.

* By design, the CyberOps Workstation VM utilizes default locations and definitions as much as possible. Conventionally, the /var/log directory holds various log files for various applications and services while configuration files are stored under the /etc directory. While the nginx manual page did not provide an exact location for its log files, it not only confirmed that nginx supports logging but also hinted at the location of a configuration file. Because the log file locations can often be customized in configuration files, a logical next step is to use the ls command to look under /etc and look for a nginx configuration file:

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/e256743a-bff9-44af-b0f1-420fd0037b94)

* Notice the nginx folder under /etc in the output above. Using ls again, we find a number of files, including one named nginx.conf.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/fa7caa4f-8ae3-443f-9e26-52638eab1fe1)

* Use the `cat` command to list the contents of `/etc/nginx/nginx.conf`. You can also use more or less to view the file and nano or SciTE to edit it. These tools make it easier to navigate through long text files (only the output of cat is displayed below).

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/4cf81a1e-103e-40e4-bc68-d36dacf3679b)

* A quick look at the configuration file reveals that it is an nginx configuration file. Because there is no direct mention to the location of nginx log files, it is very likely that nginx is using default values for it. Following the convention of storing log files under /var/log, use the ls command to list its contents:

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/c580d120-18e9-4fc7-ba95-3d01a68d118d)

* As shown above, the /var/log directory has a subdirectory named nginx. Use the ls command again to list the contents of /var/log/nginx.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/7ac01801-c14b-48b2-b6c3-0e210534c6f7)

* These are very likely to be the log files in use by nginx. Move on to the next section to monitor these files and get confirmation that they are indeed nginx log files.

## Part 3: Monitoring Log Files in Real Time

> As seen in the previous sections, log files can be displayed with many text-presentation tools. While cat,
more, less, and nano can be used to work with log files, they are not suitable for log file real-time monitoring.
Developers designed various tools that allow for log file real-time monitoring. Some tools are text-based while
others have a graphical interface. This lab focuses on tail, a simple but efficient tool, available in practically
every Unix-based system.

> The CyberOps Workstation VM uses a log rotating system to ensure that older logs are archived. By the time
this lab gets used in class, some time will have passed and the log files will likely have been rotated. The
result is that some log files, including the access.log file, could appear empty. To work around this problem
and create some entries in access.log, simply open Firefox in the VM, point it to 127.0.0.1 and reload the
page a few times.

### Step 1: Using the tail command

* The tail command displays the end of a text file. By default, tail will display the last ten (10) lines of a text file
* Use the `tail` command to display the end of the `/etc/nginx/nginx.conf`.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/1135f3f2-ab21-4a62-add5-5d14a6f61eb1)

*  Use the –n option to specify how many lines from the end of a file, tail should display

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/d7cdca01-7ac2-4678-9ef0-257870b0699f)

* You can use the tail command with the -f option to monitor the nginx access.log in real-time. Short for follow, -f tells tail to continuously display the end of a given text file. In a terminal window, issue tail with the –f option:

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/71c0cb39-dafe-4c22-9ca3-1508fcf6244e)

* As before, tail displays the last 10 lines of the file. However, notice that tail does not exit after displaying the lines; the command prompt is not visible, indicating that tail is still running.
* With tail still running on the terminal window, click the web browser icon on the Dock to open a web browser window. Re-size the web browser window in a way that it allows you to see the bottom of the terminal window where tail is still running.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/dbc79838-6663-4e8b-91e7-16fb1d8d1c94)

*  In the web browser address bar, enter 127.0.0.1 and press Enter. This is the address of the VM itself, which tells the browser to connect to a web server running on the local computer. A new entry should be recorded in the /var/log/nginx/access.log file. Refresh the webpage to see new entries added to the log
* Because tail is still running, it should display the new entry at the bottom of the terminal window. Aside from the timestamp, your entry should look like the one above.
* Because the log file is being updated by nginx, we can state with certainty that /var/log/acess.log is in fact the log file in use by nginx.
* Enter Ctrl + C to end the tail monitoring session.

### Step 2: BONUS TOOL: Journalctl

> An init system is a set of rules and conventions governing the way the user space in a given Linux system is
created and made available to the user. Init systems also specify system-wide parameters such as global
configuration files, logging structure and service management.
Systemd is a modern init system designed to unify Linux configuration and service behavior across all Linux
distributions and has been increasingly adopted by major Linux distributions. Arch Linux relies on systemd for
init functionality. The CyberOps Workstation VM also uses systemd.
system-journald (or simply journald) is systemd’s event logging service and uses append-only binary files
serving as its log files. Notice that journald does not impede the use of other logging systems, such as syslog
and rsyslog.

* In a terminal window in the CyberOps Workstation VM, issue the journalctl command with no options to display all journal log entries (it can be quite long):

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/24676a72-0da7-4f31-91b1-d1e1667f81ce)

* The output begins with a line similar to the one below, marking the timestamp where the system started logging. Notice that the timestamps will vary from system to system.

            -- Logs begin at Tue 2018-03-20 16:10:08 EDT, end at Thu 2023-05-18 01:43:41 EDT. --

* journalctl includes a number of functionalities such as page scrolling, color-coded messages and more. Use the keyboard up/down arrow keys to scroll up/down the output, one line at a time. Use the left/right keyboard arrow keys to scroll sideways and display log entries that span beyond the boundaries of the terminal window. The <ENTER> key displays the next line while the space bar displays the next page in the output. Press the q key to exit journalctl.

* This message reminds you that, because analyst is a regular user and not a member of either the adm, systemd-journal or wheel groups, not all log entries will be displayed by journalctl. It also states that running journalctl with the –q option suppresses the hint message.

* journalctl includes options to help in filtering the output. Use the –b option to display boot-related log entries:

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/d5bfa02e-ab3f-4628-a0ad-b3b47ce6bf80)

* To see entries related to the last boot, add the -1 to the command above. To see entries related to the two last boots, add the -2 option.      

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/666ba44f-e891-4322-b49a-f74a20a0b0ad)

* Use the --list-boots option to list previous boots:

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/3b54889d-b652-465a-bc19-5dba3d7989ec)

* Use the `--since <time range>` to specify the time range of which log entries should be displayed. The two commands below display all log entries generated in the last two hours and in the last day, respectively:

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/8b59322a-9eee-4d99-9694-10cd837f0658)

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/6f735d2c-7c32-477b-9bed-741d20316e82)

