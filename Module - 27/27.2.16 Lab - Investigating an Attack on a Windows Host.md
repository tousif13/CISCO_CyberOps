# 27.2.16 Lab - Investigating an Attack on a Windows Host

## Part 1: Investigate the Attack with Sguil

* In Part 1, you will use Sguil to check the IDS alerts and gather more information about the series of events related to an attack on 3-19-2019.

### Step 1: Open Sguil and locate the alerts on 3-19-2019

* Login to Security Onion VM with the analyst username and cyberops password.
* Launch Sguil from the desktop. Login with username analyst and password cyberops. Click Select All and Start Sguil to view all the alerts generated by the network sensors.
* Locate the group of alerts from 19 March 2019.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/7a133007-be63-46a0-8a78-415233596875)

* According to Sguil, what are the timestamps for the first and last of the alerts that occurred on 3-19-2019? What is interesting about the timestamps of all the alerts on 3-19-2019?

       01:45:03 to 04:54:34 and most of the alerts came in the span of 3 minutes

### Step 2: Review the alerts in detail.

* In Sguil, click the first of the alerts on 3-19-2019 (Alert ID 5.439). Make sure to check the `Show Packet Data` and `Show Rule` checkboxes to examine the packet header information and the IDS signature rule related to the alert. Right on the Alert ID and pivot to Wireshark. Based on the information derived from 
this initial alert answer the following questions:
* What was the source IP address and port number and destination IP address and port number?

      Source      - 10.0.90.215:52609
      Destination - 10.0.90.9:53

* What type of protocol and request or response was involved?

      UDP protocol
      DNS dynamic update
      DNS dynamic update response

* What is the IDS alert and message?

      alert udp $EXTERNAL_NET any -> $HOME_NET 53, msg: "ET POLICY DNS Update from External net"

* Do you think this alert was the result of an IDS misconfiguration or a legitimate suspicious communication?

      This alert may be the result of an IDS misconfiguration because the DNS request was a Dynamic DNS update from an internal host to a DNS server on the internal network itself

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/01d0460b-e457-49a3-a33f-6fc16fbe1798)

* What is the hostname, domain name, and IP address of the source host in the DNS update?

      hostname    - Bobby-Tiger-PC
      domain name - littletigers.info
      IP address  - 10.0.90.215

* In Sguil, select the second of the alerts on 3-19-2019. Right click the Alert ID 5.440 and select `Transcript`.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/a1b964f3-424b-4409-8252-3a6e9d31e659)

* From the transcript answer the following questions:
* What is the source and destination IP address and port numbers?

      Source      - 10.0.90.215:49204
      Destination - 209.141.34.8:80

* Looking at the request (blue) what was the request for?

      GET /test1.exe HTTP/1.1

* Looking at the reply (red) many files will reveal their file signature in the initial few characters of the filewhen viewed as text. File signatures help identify the type of file that is represented. Use a web browser 
to search for a list of common file signatures.
* What is the initial few characters of the file file. Search for this file signature to find out what type of file was downloaded in the data?

      Initial few characters of the file are MZ and it is a DOS MZ executable and its descendants

* Close the transcript. Use Wireshark to export the executable file for malware analysis (`File > Export Objects > HTTPâ€¦`). Save the file to the analyst's home folder.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/903c16f0-1571-4020-a366-5a700a2e3c92)

* Open a terminal in Security Onion VM and create a SHA256 hash from the exported file. Use the following command:

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/4ed93273-92f0-44aa-b109-1b89eaf85ba3)

* Copy the file hash and submit it to the Cisco Talos file reputation center at https://talosintelligence.com/talos_file_reputation.

