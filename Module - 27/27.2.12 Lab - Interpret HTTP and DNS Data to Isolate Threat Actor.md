# 27.2.12 Lab - Interpret HTTP and DNS Data to Isolate Threat Actor

> MySQL is a popular database used by numerous web applications. Unfortunately, SQL injection is a common 
web hacking technique. It is a code injection technique where an attacker executes malicious SQL statements 
to control a web application's database server.

> Domain name servers (DNS) are directories of domain names, and they translate the domain names into IP 
addresses. This service can be used to exfiltrate data. 

> Cybersecurity personnel have determined that an exploit has occurred, and data containing PII may have 
been exposed to threat actors. In this lab, you will use Kibana to investigate the exploits to determine the data 
that was exfiltrated using HTTP and DNS during the attacks.

## Part 1: Investigate an SQL Injection Attack

* In this part, you will investigate an exploit in which unauthorized access was made to sensitive information that is stored on a web server. You will use Kibana to determine the source of the attack and the information accessed by the attacker

### Step 1: Change the timeframe

* It has been determined that the exploit happened at some time during the month of June 2020. Kibana defaults to displaying data for the last 24 hours. You will need to change the time settings to see the data for the month of June 2020.
* Start the Security Onion VM and login with the username `analyst` and the password `cyberops`.
* Enter the `sudo so-status` command to check the status of services. The status for all the services should be `OK` before starting your analysis. This could take a few minutes.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/5f4beb0e-5268-40f8-95d8-67387dd04567)

* After you log in, open Kibana using the shortcut on the Desktop. Login with the username analyst and the password cyberops.
* In Security Onion, Kibana has many pre-built dashboards and visualizations for monitoring and analysis. You can also create your own custom dashboards and visualizations catered to monitoring your particular network environment. Note: Your dashboard may not have any results in the last 24 hours
* In the upper-right corner of the window, click Last 24 hours to change the sample Time Range size. Expand the time range to include the interesting alerts. An SQL injection attack took place in June 2020 so that is what you need to target. Select Absolute under Time Range and edit the From and To times to include the entire month of June in 2020. Click Go to continue.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/7b366a6c-e97d-4809-8fa2-e645fa9fc39b)

* Notice the total number of logs for the entire month of June 2020. Your dashboard should be similar to that shown in the figure. Take a moment to explore the information that is provided by the Kibana interface

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/7c57ce0e-8460-40da-b315-e68bfb9ab7e6)

### Step 2: Filter for HTTP traffic

* Because the threat actor assessed data that is stored on a web server, the HTTP filter is used to select the logs associated with HTTP traffic. Select `HTTP` under the Zeek Hunting heading, as shown in the figure
* Scroll through the results and answer the following questions:

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/7b688127-a492-4e28-a9ac-2ce61ac0d8a1)

* What is the source IP address?

      209.165.200.227

* What is the destination IP address?

      209.165.200.235
  
* What is the destination port number?

      80

* Scroll down to the HTTP Logs. The results list the first 10 results.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/94b8a5bc-4eca-40fa-b60a-691af942d2cf)

* Expand the details of the first result by clicking the arrow that is next to the log entry timestamp. Note the information that is available.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/330df1a3-18ce-4ab5-b70c-13e5b77e4f0d)

* What is the timestamp of the first result?

      June 12th 2020, 21:30:09.445
  
* What is the event type?

      bro_http
  
* What is included in the message field? These are details about the HTTP GET request that was made by the client to the server. Focus especially on the uri field in the message text.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/4149d9aa-5f39-4ff2-b244-1bf84d4398ad)

      Consists of SQL logic of retrieving card details such as ccid, ccnum, ccv , expiration

* What is the significance of this information?

      It is a request of retrieving card details

### Step 3: Review the results

* Some of the information for the log entries is hyperlinked to other tools. Click the value in the alert `_id` field of the log entry to get a different view on the event.
* The result opens in a new web browser tab with information from capME!. capME! tab is a web interface that allows you to view a pcap transcript. The blue text contains HTTP requests that are sent from the source (SRC). The red text is responses from the destination web server (DST).

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/3079f78f-fbd1-4b92-b4b4-e3737161b264)

* In the Log entry section, which is at the beginning of the transcript, notice the portion `username='+union+select+ccid,ccnumber,ccv,expiration,null+from+credit_cards+--+&password=` indicates that someone may have tried to attack the web browser using SQL injection to bypass authentication. The keywords, `union` and `select`, are commands that are used in searching for information in a SQL database. If the input boxes on a web page are not properly protected from illegal input, threat actors can inject SQL search strings or other code that can access data contained in 
databases that are linked to the web page.
* Find for the keyword `username` in the transcript. Use `Ctrl-F` to open a search box. Use the down arrow button in the search box to scroll through the occurrences that were found

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/3af5a80e-0ac5-4f8a-87de-2353468dc4e3)

