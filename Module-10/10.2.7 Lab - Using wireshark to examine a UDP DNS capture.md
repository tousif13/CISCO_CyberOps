# 10.2.7 Lab - Using Wireshark to Examine a UDP DNS Capture

### Topology

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/875a7ac6-934a-4018-b183-4b0c31c1efac)

## Part 1: Record VM's IP Configuration Information

* In Part 1, you will use commands on your CyberOps Workstation VM to find and record the MAC and IP addresses of your VM’s virtual network interface card (NIC), the IP address of the specified default gateway, and the DNS server IP address specified for the PC. Record this information in the table provided. The information will be used in parts of this lab with packet analysis

* Your CyberOps Workstation VM network settings should be set to bridged adapter. To check your network settings go to: Machine > Settings, select Network, the tab Adapter 1, Attached to: Bridged Adapter.
* Open a terminal in the VM. Enter ifconfig at the prompt to display interface information.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/df59f2df-1597-45ba-9c6d-6cfda29414b8)

* At the terminal prompt, enter `cat /etc/resolv.conf` to determine the DNS server.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/718060c4-86b1-4988-bb4d-c262703abe92)

* At the terminal prompt, enter netstat -rn to display the IP routing table to the default gateway IP address.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/6c015e11-77d0-4a8b-a4fe-f250546d6107)

* The DNS IP address and default gateway IP address are often the same, especially in small 
networks. However, in a business or school network, the addresses would most likely be different.

      IP address                 -   10.11.140.195
      MAC address                -   08:00:27:89:bc:37
      Default gateway IP address -   10.11.128.1
      DNS server IP address      -   10.11.128.1

## Part 2: Use Wireshark to Capture DNS Queries and Responses

In Part 2, you will set up Wireshark to capture DNS query and response packets. This will demonstrate the use of the UDP transport protocol while communicating with a DNS server

* In the terminal window, start Wireshark and click OK when prompted.
* In the Wireshark window, select and double-click enp0s3 from the interface list.
* Open the web browser and navigate to www.google.com.
* Click Stop to stop the Wireshark capture when you see Google’s home page

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/a37490be-40fc-4c75-8f3e-5f30cdca9faf)

## Part 3: Analyze Captured DNS or UDP Packets

In Part 3, you will examine the UDP packets that were generated when communicating with a DNS server for the IP addresses for www.google.com

### Step 1: Filter DNS packets.

*  In the Wireshark main window, type dns in the Filter field. Click Apply
*  In the packet list pane (top section) of the main window, locate the packet that includes Standard query and A www.google.com. See frame 429 above as an example

### Step 2: Examine the fields in a DNS query packet.

![image](https://github.com/tousif13/CISCO_CyberOps/assets/33444140/fb6ea35c-2d3a-4b14-b65e-183d43384307)

* The protocol fields, highlighted in gray, are displayed in the packet details pane (middle section) of the main window.
* In the first line in the packet details pane, frame 17 had 74 bytes of data on the wire. This is the number of bytes it took to send a DNS query to a named server requesting the IP addresses of www.google.com. If you used a different web address, such as www.cisco.com, the byte count might be different.
* The Ethernet II line displays the source and destination MAC addresses. The source MAC address is from your VM because your VM originated the DNS query. The destination MAC address is from the default gateway because this is the last stop before this query exits the local network.
* Is the source MAC address the same as the one recorded from Part 1 for the VM?

        Yes

* In the Internet Protocol Version 4 line, the IP packet Wireshark capture indicates that the source IP address of this DNS query is 10.0.2.15 and the destination IP address is 8.8.4.4. In this example, the destination address is the DNS server.

Can you identify the IP and MAC addresses for the source and destinations of this packet?

      Source Workstation     - 10.0.2.15 , 08:00:27:89:bc:37
      Destination DNS server - 8.8.4.4   , 52:54:00:12:35:02

*  A UDP header only has four fields: source port, destination port, length, and checksum. Each field in a UDP header is only 16 bits as depicted below.
* Click the arrow next to User Datagram Protocol to view the details. Notice that there are only four fields. The source port number in this example is 40873. The source port was randomly generated by the VM using port numbers that are not reserved. The destination port is 53. Port 53 is a well-known port reserved for use with DNS. DNS servers listen on port 53 for DNS queries from clients.
*  In this example, the length of the UDP segment is 40 bytes. Out of 40 bytes, 8 bytes are used as the header. The other 32 bytes are used by DNS query data. The 32 bytes of DNS query data is in the following illustration in the packet bytes pane (lower section) of the Wireshark main window
* The checksum is used to determine the integrity of the UDP header after it has traversed the internet.
* The UDP header has low overhead because UDP does not have fields that are associated with the threeway handshake in TCP. Any data transfer reliability issues that occur must be handled by the application layer.
